{% extends 'blog/base.html' %}
<!--{% load crispy_forms_tags %}-->
{% block content %}
    {% load static %}
    <div class="container">
        {% if user.is_authenticated %}
            <article class="media content-section" style="margin-bottom: 30px">
                <img class="rounded-circle article-img" src="{{ user.profile.image.url }}" alt="">
                <div class="media-body text-center my-auto">
                    <div class="form-group">
                        <button class="btn btn-outline-primary form-control form-rounded" id="message"
                                data-toggle="modal"
                                data-target="#mymodal">Tell Us Something Good!
                        </button>
                    </div>
                </div>
            </article>

            <!-- MODAL -->
            <div class="modal fade" id="mymodal" tabindex="-1" role="dialog"
                 aria-labelledby="post-modalLabel" aria-hidden="true"
                 style="display: none;">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="post-modalLabel">Create
                                Post</h5>
                            <button type="button" class="btn btn-secondary"
                                    data-dismiss="modal"><i
                                    class="ri-close-fill"></i></button>
                        </div>

                        <div class="div_select_public_private">
                            <select name="public_private" id="select_public">
                                <option value="public">Public</option>
                                <option value="private">Private</option>
                            </select>
                        </div>

                        <div class="modal-body">

                            <div class="d-flex align-items-center">
                                <div class="user-img">
                                    <img src="{{ user.profile.image.url }}"
                                         alt="userimg"
                                         class="avatar-60 rounded-circle img-fluid">
                                </div>
                                <form class="post-text ml-3 w-100"
                                      action="javascript:void(0);">
                                    <input type="text" class="form-control rounded"
                                           placeholder="Write something here..." id="input_post_content"
                                           style="border:none;">
                                </form>
                            </div>
                            <hr>
                            <ul class="d-flex flex-wrap align-items-center list-inline m-0 p-0">
                                <li class="col-md-6 mb-3">
                                    <div class="iq-bg-primary rounded p-2 pointer mr-3">
                                        <input type="file" class="input_file_hidden" id="input_post_image"
                                               onchange="preview_post_image()" multiple>
                                        <label for="input_post_image"><img
                                                src="{% static 'users/images/small/07.png' %}"
                                                alt="icon" class="img-fluid">
                                            Photo/Video</label>
                                    </div>
                                </li>
                            </ul>

                            <div id="div_preview_post_image" class="row">

                            </div>

                            <hr>
                            <button type="button" class="btn btn-primary d-block w-100 mt-3"
                                    onclick="submit_new_post()">
                                Post
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
        {% for post in posts %}
            <div class="post_box">
                <article class="media content-section">
                    <img class="rounded article-img mt-2" src="{{ post.author.profile.image.url }}" alt="">
                    <div class="media-body">
                        <div class="article-metadata">
                            <a class="mr-2" href="javascript:void(0)"
                               onclick="checkBlock({{ post.author.id }}, '{{ post.author.username }}')">{{ post.author.profile.user.first_name }}
                                {{ post.author.profile.user.last_name }}</a>
                            <small class="text-muted">{{ post.date_posted|date:"F d, Y" }}</small>
                        </div>
                        <h2><a class="article-title" href="{% url 'post-detail' post.id %}">{{ post.title }}</a></h2>
                        <p class="article-content">{{ post.content }}</p>

                        <div class="div_post_images row">
                            {% for image in post.images %}
                                <div class="col-3" style="width: 100%;">
                                    <img src="/media/{{ image }}" class="img_post" alt="image"
                                         style="width: 98%; height: 100%">
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </article>
                <div class="comment-area mt-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="like-block position-relative d-flex align-items-center">
                            <div class="total-comment-block">
                                <div class="dropdown">
                                    <span class="dropdown-toggle"
                                          data-toggle="dropdown"
                                          aria-haspopup="true"
                                          aria-expanded="false" role="button">
                                                                                     <span id="num_comment_{{ post.id }}">{{ post.comments.all|length }}</span> Comments
                                                                            </span>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item" href="#">Max
                                            Emum</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="share-block  text-right feather-icon mr-2">
                            <span role="button">
                                                                        <img src="{% static 'users/images/icon/01.png' %}"
                                                                             class="img-fluid" alt="">
                                                                    </span>
                            <a href="javascript:void(0);"><i
                                    class="ssri-share-line"></i>
                                <span class="ml-1"
                                      onclick="upvote({{ post.id }}, {{ post.author.id }})"><span
                                        id="upvote_{{ post.id }}">{{ post.like|length }}</span> Upvotes</span></a>&nbsp;&nbsp;
                            <a href="javascript:void(0);"><span
                                    class="fa fa-thumbs-down"></span><span
                                    class="ml-1"
                                    onclick="downvote({{ post.id }}, {{ post.author.id }})">
                                <span id="downvote_{{ post.id }}">
                                    {% if post.dislike|length == 0 %}
                                        0
                                    {% else %}
                                        -{{ post.dislike|length }}
                                    {% endif %}
                                </span> Downvotes</span></a>
                        </div>
                    </div>
                    <hr>
                    <ul class="post-comments p-0 m-0"
                        id="post_comments_{{ post.id }}"
                        data-id="{{ post.id }}">

                        {% for comment in post.comments.all %}
                            <li class="mb-2">
                                <div class="d-flex flex-wrap">
                                    <div class="user-img">
                                        <img src="/media/{{ comment.author.profile.image }}"
                                             alt="userimg"
                                             class="avatar-35 rounded-circle img-fluid">
                                    </div>
                                    <div class="comment-data-block ml-3">
                                        <h6>{{ comment.author.first_name }} {{ comment.author.last_name }}</h6>
                                        <p class="mb-0"> {{ comment.content }} </p>
                                        {% if comment.image != '' %}
                                            <img src="/media/{{ comment.image }}" alt="" style="width: 80%; margin: auto; margin-left: 10%">
                                        {% endif %}
                                        <div class="d-flex flex-wrap align-items-center comment-activity">
                                            <a href="javascript:void();">like</a>
                                            <a href="javascript:void();">reply</a>
                                            <a href="javascript:void();">translate</a>
                                            <span> 5 min </span>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        {% endfor %}

                    </ul>

                    <div class="div_preview_comment_image row">

                    </div>

                    <form class="comment-text d-flex align-items-center mt-3"
                          action="javascript:void(0);">
                        <input type="text"
                               class="form-control rounded input_comment">
                        <div class="comment-attagement d-flex">
                            <input type="file" style="padding-right: 0px"
                                   data-id="{{ post.id }}"
                                   class="input_file_hidden input_comment_image"
                                   id="input_comment_image{{ post.id }}"
                            >
                            <label for="input_comment_image{{ post.id }}"><i
                                    class="ri-camera-line mr-3"></i></label>
                        </div>
                    </form>
                </div>
            </div>
        {% endfor %}
        {% if is_paginated %}
            {% if page_obj.has_previous %}
                <a class="btn btn-outline-info mb-4" href="?page=1">First</a>
                <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.previous_page_number }}">Previous</a>
            {% endif %}
            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                    <a class="btn btn-info mb-4" href="?page={{ num }}">{{ num }}</a>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <a class="btn btn-outline-info mb-4" href="?page={{ num }}">{{ num }}</a>
                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
                <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.next_page_number }}">Next</a>
                <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.paginator.num_pages }}">Last</a>
            {% endif %}
        {% endif %}
    </div>


{% endblock content %}
